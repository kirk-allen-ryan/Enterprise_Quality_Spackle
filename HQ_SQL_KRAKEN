/* Encounter Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  PERSON_ALIAS_MRN_ORG.ALIAS,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  ENCOUNTER.REASON_FOR_VISIT,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  PERSON_ALIAS  PERSON_ALIAS_MRN_ORG,
  CODE_VALUE  CV_PERSON_ALIAS_ORG,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_PERSON_ALIAS_ORG.CODE_VALUE=PERSON_ALIAS_MRN_ORG.PERSON_ALIAS_TYPE_CD  )
  AND  ( PERSON.PERSON_ID=PERSON_ALIAS_MRN_ORG.PERSON_ID AND PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1
AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CV_PERSON_ALIAS_ORG.CDF_MEANING='MRN'
and PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1 AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   ENCOUNTER.DISCH_DT_TM  Is Null  
   AND
   ENCOUNTER.ENCNTR_TYPE_CD  IN  ( 309314  )
   AND
   CV_FACILITY.CODE_VALUE  IN  @prompt('Enter value(s) for Person Location- Facility (Curr)','A','Location\Person Location- Facility (Curr)',Multi,Constrained_key,Persistent,,User:0,KEY_'N')
  )

/* Therapy Document Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  PERSON_ALIAS_MRN_ORG.ALIAS,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  ENCOUNTER.REASON_FOR_VISIT,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED,
  pi_from_gmt(DCP_FORMS_ACTIVITY.FORM_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))

,
  DCP_FORMS_REF.DESCRIPTION,
  CV_Form_Status.DISPLAY,
  DCP_FORMS_ACTIVITY_PRSNL.PRSNL_FT,
  CV_FORMS_POSITION.DISPLAY,
  DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID 
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  PERSON_ALIAS  PERSON_ALIAS_MRN_ORG,
  CODE_VALUE  CV_PERSON_ALIAS_ORG,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON,
  DCP_FORMS_ACTIVITY,
  DCP_FORMS_REF,
  CODE_VALUE  CV_Form_Status,
  DCP_FORMS_ACTIVITY_PRSNL,
  CODE_VALUE  CV_FORMS_POSITION,
  PRSNL  PRSNL_DCP_FORMS_ACT
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( DCP_FORMS_REF.DCP_FORMS_REF_ID=DCP_FORMS_ACTIVITY.DCP_FORMS_REF_ID
AND DCP_FORMS_REF.ACTIVE_IND = 1  )
  AND  ( CV_Form_Status.CODE_VALUE=DCP_FORMS_ACTIVITY.FORM_STATUS_CD  )
  AND  ( CV_PERSON_ALIAS_ORG.CODE_VALUE=PERSON_ALIAS_MRN_ORG.PERSON_ALIAS_TYPE_CD  )
  AND  ( PERSON.PERSON_ID=PERSON_ALIAS_MRN_ORG.PERSON_ID AND PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1
AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID=DCP_FORMS_ACTIVITY_PRSNL.DCP_FORMS_ACTIVITY_ID  )
  AND  ( DCP_FORMS_ACTIVITY.ENCNTR_ID=ENCOUNTER.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 and DCP_FORMS_ACTIVITY.PERSON_ID = ENCOUNTER.PERSON_ID  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( DCP_FORMS_ACTIVITY_PRSNL.PRSNL_ID=PRSNL_DCP_FORMS_ACT.PERSON_ID  )
  AND  ( PRSNL_DCP_FORMS_ACT.POSITION_CD=CV_FORMS_POSITION.CODE_VALUE  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CV_PERSON_ALIAS_ORG.CDF_MEANING='MRN'
and PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1 AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   ENCOUNTER.DISCH_DT_TM  Is Null  
   AND
   ENCOUNTER.ENCNTR_TYPE_CD  IN  ( 309314  )
   AND
   CV_FACILITY.DISPLAY  IN  @dpvalue('A', DP2.DO10e)
   AND
   CV_FORMS_POSITION.DISPLAY  IN  ( 'Occupational Therapist','Occupational Therapist ASC','Occupational Therapist Research','Occupational Therapy Assistant','Physical Therapist','Physical Therapist ASC','Physical Therapist Research','Physical Therapy Assistant','Rehab Director','Rehab Director ASC','Rehab Director Research','Speech Language Pathologist','Speech Language Pathologist ASC'  )
   AND
   DCP_FORMS_ACTIVITY.FORM_STATUS_CD  IN  ( 25, 34, 35  )
   AND
   DCP_FORMS_REF.DCP_FORMS_REF_ID  IN  ( 493111539, 498450799, 495299097, 498451529, 493242839, 667476179, 787531423, 629340273, 820714081, 498451719, 498451881, 497793567, 498452181, 586556243, 495594441, 497748395, 812721207, 812719867, 498452411, 498452563, 498452721, 498452869, 495640395, 667391765, 629341011, 771114193, 498453039, 498453151, 498453309, 498453477, 498453635, 586249307, 495620859, 777877521, 497751561, 495678999, 495699713, 497877257, 498857347, 495708539, 667533407, 495758217, 495746711, 497887821, 495738929, 586562199, 495731347, 495766635, 495777247  )
  )

/* Plan of Care Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  PERSON_ALIAS_MRN_ORG.ALIAS,
  CE_SECTIONS.EVENT_TITLE_TEXT,
  pi_from_gmt(DCP_FORMS_ACTIVITY.FORM_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))

,
  DCP_FORMS_ACTIVITY_PRSNL.PRSNL_FT,
  CV_FORMS_POSITION.DISPLAY,
  DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID ,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  ENCOUNTER.REASON_FOR_VISIT,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED,
  DCP_FORMS_REF.DESCRIPTION,
  CV_Form_Status.DISPLAY,
  CV_EVENT_CD_DOC.DISPLAY,
  CLINICAL_EVENT_DOC.RESULT_VAL,
  to_date(to_char(pi_from_gmt(CE_DATE_RESULT_DOC.RESULT_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),'dd/mm/yyyy'),'dd/mm/yyyy')


to_
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  PERSON_ALIAS  PERSON_ALIAS_MRN_ORG,
  CODE_VALUE  CV_PERSON_ALIAS_ORG,
  CLINICAL_EVENT  CE_SECTIONS,
  DCP_FORMS_ACTIVITY,
  DCP_FORMS_ACTIVITY_PRSNL,
  CODE_VALUE  CV_FORMS_POSITION,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON,
  DCP_FORMS_REF,
  CODE_VALUE  CV_Form_Status,
  CODE_VALUE  CV_EVENT_CD_DOC,
  CODE_VALUE  cv_record_status_cd,
  CLINICAL_EVENT  CLINICAL_EVENT_DOC,
  CE_DATE_RESULT  CE_DATE_RESULT_DOC,
  DCP_FORMS_ACTIVITY_COMP,
  PRSNL  PRSNL_DCP_FORMS_ACT
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( DCP_FORMS_REF.DCP_FORMS_REF_ID=DCP_FORMS_ACTIVITY.DCP_FORMS_REF_ID
AND DCP_FORMS_REF.ACTIVE_IND = 1  )
  AND  ( CV_Form_Status.CODE_VALUE=DCP_FORMS_ACTIVITY.FORM_STATUS_CD  )
  AND  ( CLINICAL_EVENT_DOC.EVENT_ID=CE_DATE_RESULT_DOC.EVENT_ID(+)  )
  AND  ( cv_record_status_cd.CODE_VALUE=CLINICAL_EVENT_DOC.RECORD_STATUS_CD
and cv_record_status_cd.cdf_meaning = 'ACTIVE'  )
  AND  ( CLINICAL_EVENT_DOC.EVENT_CD=CV_EVENT_CD_DOC.CODE_VALUE AND CV_EVENT_CD_DOC.ACTIVE_IND=1  )
  AND  ( CV_PERSON_ALIAS_ORG.CODE_VALUE=PERSON_ALIAS_MRN_ORG.PERSON_ALIAS_TYPE_CD  )
  AND  ( PERSON.PERSON_ID=PERSON_ALIAS_MRN_ORG.PERSON_ID AND PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1
AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID=DCP_FORMS_ACTIVITY_PRSNL.DCP_FORMS_ACTIVITY_ID  )
  AND  ( DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID=DCP_FORMS_ACTIVITY_COMP.DCP_FORMS_ACTIVITY_ID
and DCP_FORMS_ACTIVITY.active_ind=1 AND DCP_FORMS_ACTIVITY_COMP.PARENT_ENTITY_NAME = 'CLINICAL_EVENT'  )
  AND  ( DCP_FORMS_ACTIVITY_COMP.PARENT_ENTITY_ID=CE_SECTIONS.PARENT_EVENT_ID
AND CE_SECTIONS.VIEW_LEVEL=0  )
  AND  ( CE_SECTIONS.EVENT_ID=CLINICAL_EVENT_DOC.PARENT_EVENT_ID
AND CLINICAL_EVENT_DOC.VIEW_LEVEL=1
AND CLINICAL_EVENT_DOC.VALID_UNTIL_DT_TM> pi_to_gmt(sysdate, pi_time_zone(1,@variable('BOUSER')))  )
  AND  ( DCP_FORMS_ACTIVITY.ENCNTR_ID=ENCOUNTER.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 and DCP_FORMS_ACTIVITY.PERSON_ID = ENCOUNTER.PERSON_ID  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( DCP_FORMS_ACTIVITY_PRSNL.PRSNL_ID=PRSNL_DCP_FORMS_ACT.PERSON_ID  )
  AND  ( PRSNL_DCP_FORMS_ACT.POSITION_CD=CV_FORMS_POSITION.CODE_VALUE  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( CE_DATE_RESULT_DOC.VALID_UNTIL_DT_TM(+) = to_date('12/31/2100','MM/DD/YYYY') 
  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CE_SECTIONS.VALID_UNTIL_DT_TM > pi_to_gmt(sysdate, pi_time_zone(1,@Variable('BOUSER')))   )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CV_PERSON_ALIAS_ORG.CDF_MEANING='MRN'
and PERSON_ALIAS_MRN_ORG.ACTIVE_IND = 1 AND PERSON_ALIAS_MRN_ORG.END_EFFECTIVE_DT_TM > SYSDATE  )
  AND  ( CV_EVENT_CD_DOC.active_ind = 1  )
  AND  ( CLINICAL_EVENT_DOC.TASK_ASSAY_CD != 0  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   ENCOUNTER.DISCH_DT_TM  Is Null  
   AND
   CV_ENCOUTER_TYPE.DISPLAY  IN  @dpvalue('A', DP2.DO9e)
   AND
   CV_FACILITY.DISPLAY  IN  @dpvalue('A', DP2.DO10e)
   AND
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   DCP_FORMS_REF.DCP_FORMS_REF_ID  IN  ( 497748395, 497751561, 497754211  )
  )

/* POC Forward Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  ENCOUNTER.REASON_FOR_VISIT,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED,
  CV_EVENT.DISPLAY,
  CV_RESULT_STATUS.DISPLAY,
  CLINICAL_EVENT.PARENT_EVENT_ID,
  pi_from_gmt(CLINICAL_EVENT.EVENT_END_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))
,
  CE_PRSNL.NAME_FULL_FORMATTED,
  PI_GET_CV_DISPLAY(CE_PRSNL.POSITION_CD),
  pi_get_cv_display(CE_EVENT_PRSNL.ACTION_TYPE_CD),
  PRSNL_CE_ACTION.NAME_FULL_FORMATTED,
  pi_get_cv_display(PRSNL_CE_ACTION.POSITION_CD),
  pi_from_gmt(CE_EVENT_PRSNL.ACTION_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  pi_get_cv_display(CE_EVENT_PRSNL.ACTION_STATUS_CD),
  pi_from_gmt(CE_EVENT_PRSNL.VALID_UNTIL_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  pi_from_gmt(CE_EVENT_PRSNL.REQUEST_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))
,
  PRSNL_CE_REQUEST.NAME_FULL_FORMATTED,
  pi_get_cv_display(PRSNL_CE_REQUEST.POSITION_CD),
  CLINICAL_EVENT.EVENT_TAG
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON,
  CODE_VALUE  CV_EVENT,
  CODE_VALUE  CV_RESULT_STATUS,
  CLINICAL_EVENT,
  PRSNL  CE_PRSNL,
  CE_EVENT_PRSNL,
  PRSNL  PRSNL_CE_ACTION,
  PRSNL  PRSNL_CE_REQUEST,
  PERSON  CE_PERSON
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CLINICAL_EVENT.EVENT_CD=CV_EVENT.CODE_VALUE  )
  AND  ( ENCOUNTER.ENCNTR_ID=CLINICAL_EVENT.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 AND ENCOUNTER.PERSON_ID = CLINICAL_EVENT.PERSON_ID  )
  AND  ( CLINICAL_EVENT.PERFORMED_PRSNL_ID=CE_PERSON.PERSON_ID  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( CLINICAL_EVENT.RESULT_STATUS_CD=CV_RESULT_STATUS.CODE_VALUE  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( CE_PERSON.PERSON_ID=CE_PRSNL.PERSON_ID  )
  AND  ( CLINICAL_EVENT.EVENT_ID=CE_EVENT_PRSNL.EVENT_ID  )
  AND  ( PRSNL_CE_ACTION.PERSON_ID=CE_EVENT_PRSNL.ACTION_PRSNL_ID  )
  AND  ( CE_EVENT_PRSNL.REQUEST_PRSNL_ID=PRSNL_CE_REQUEST.PERSON_ID  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   ENCOUNTER.DISCH_DT_TM  Is Null  
   AND
   CV_ENCOUTER_TYPE.DISPLAY  IN  @dpvalue('A', DP2.DO9e)
   AND
   CV_FACILITY.DISPLAY  IN  @dpvalue('A', DP2.DO10e)
   AND
   PI_GET_CV_DISPLAY(CE_PRSNL.POSITION_CD)  IN  ( 'Occupational Therapist','Occupational Therapist ASC','Occupational Therapist Research','Physical Therapist','Physical Therapist ASC','Physical Therapist Research','Rehab Director','Rehab Director ASC','Rehab Director Research','Speech Language Pathologist','Speech Language Pathologist ASC'  )
   AND
   CV_EVENT.CODE_VALUE  IN  ( 1881473353, 1881467023, 1879869919, 1879855543  )
   AND
   CV_RESULT_STATUS.DISPLAY  IN  ( 'Auth (Verified)','Modified'  )
  )

/* TCR POC SIGNED Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED,
  CV_EVENT.DISPLAY,
  pi_from_gmt(CLINICAL_EVENT.EVENT_END_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))
,
  CLINICAL_EVENT.PARENT_EVENT_ID,
  CV_RESULT_STATUS.DISPLAY,
  CE_PRSNL.NAME_FULL_FORMATTED,
  pi_from_gmt(CLINICAL_EVENT.VALID_UNTIL_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))

,
  pi_get_cv_display(CE_EVENT_PRSNL.ACTION_TYPE_CD),
  pi_from_gmt(CE_EVENT_PRSNL.ACTION_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  pi_from_gmt(CE_EVENT_PRSNL.VALID_UNTIL_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  pi_from_gmt(CE_EVENT_PRSNL.REQUEST_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))
,
  CE_PRSNL_VERF.NAME_FULL_FORMATTED,
  to_date(to_char(pi_from_gmt(CLINICAL_EVENT.PERFORMED_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),'dd/mm/yyyy'),'dd/mm/yyyy')

,
  pi_from_gmt(CLINICAL_EVENT.PERFORMED_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON,
  CODE_VALUE  CV_EVENT,
  CLINICAL_EVENT,
  CODE_VALUE  CV_RESULT_STATUS,
  PRSNL  CE_PRSNL,
  CE_EVENT_PRSNL,
  PRSNL  CE_PRSNL_VERF,
  PERSON  CE_PERSON,
  PERSON  CE_PERSON_VERF
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CLINICAL_EVENT.EVENT_CD=CV_EVENT.CODE_VALUE  )
  AND  ( ENCOUNTER.ENCNTR_ID=CLINICAL_EVENT.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 AND ENCOUNTER.PERSON_ID = CLINICAL_EVENT.PERSON_ID  )
  AND  ( CLINICAL_EVENT.PERFORMED_PRSNL_ID=CE_PERSON.PERSON_ID  )
  AND  ( CLINICAL_EVENT.VERIFIED_PRSNL_ID=CE_PERSON_VERF.PERSON_ID  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( CLINICAL_EVENT.RESULT_STATUS_CD=CV_RESULT_STATUS.CODE_VALUE  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( CE_PERSON.PERSON_ID=CE_PRSNL.PERSON_ID  )
  AND  ( CE_PRSNL_VERF.PERSON_ID=CE_PERSON_VERF.PERSON_ID  )
  AND  ( CLINICAL_EVENT.EVENT_ID=CE_EVENT_PRSNL.EVENT_ID  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CLINICAL_EVENT.PERFORMED_DT_TM = (SELECT MAX(CE.PERFORMED_DT_TM)
                                     FROM CLINICAL_EVENT CE
                                     WHERE CE.EVENT_CD  = CLINICAL_EVENT.EVENT_CD
                                     AND CE.ENCNTR_ID = CLINICAL_EVENT.ENCNTR_ID
                                     AND CE.PERSON_ID = CLINICAL_EVENT.PERSON_ID)  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   CV_FACILITY.DISPLAY  IN  @dpvalue('A', DP2.DO10e)
   AND
   CV_EVENT.CODE_VALUE  IN  ( 2312423067, 2312423073, 2312423079  )
   AND
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   CLINICAL_EVENT.VALID_UNTIL_DT_TM  >  pi_to_gmt(trunc(sysdate)+(86399/86400), ( pi_time_zone(2,@Variable('BOUSER')) ))
   AND
   CV_ENCOUTER_TYPE.DISPLAY  IN  @dpvalue('A', DP2.DO9e)
   AND
   ENCOUNTER.DISCH_DT_TM  Is Null  
  )

/* EVAL ONLY Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  CV_MEDICAL_SERVICE.DISPLAY,
  CV_SERVICE_CAT.DISPLAY,
  ENCOUNTER.REASON_FOR_VISIT,
  CV_ENCOUTER_TYPE.DISPLAY,
  pi_from_gmt(ENCOUNTER.REG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_FACILITY.DISPLAY,
  PERSON.NAME_FULL_FORMATTED,
  pi_from_gmt(DCP_FORMS_ACTIVITY.FORM_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) ))

,
  DCP_FORMS_REF.DESCRIPTION,
  CV_Form_Status.DISPLAY,
  DCP_FORMS_ACTIVITY_PRSNL.PRSNL_FT,
  CV_FORMS_POSITION.DISPLAY,
  DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID ,
  CV_EVENT_CD_DOC.DISPLAY,
  CE_CODED_RESULT_DOC.DESCRIPTOR
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  ENCOUNTER,
  CODE_VALUE  CV_MEDICAL_SERVICE,
  CODE_VALUE  CV_SERVICE_CAT,
  CODE_VALUE  CV_ENCOUTER_TYPE,
  CODE_VALUE  CV_FACILITY,
  PERSON,
  DCP_FORMS_ACTIVITY,
  DCP_FORMS_REF,
  CODE_VALUE  CV_Form_Status,
  DCP_FORMS_ACTIVITY_PRSNL,
  CODE_VALUE  CV_FORMS_POSITION,
  CODE_VALUE  CV_EVENT_CD_DOC,
  CE_CODED_RESULT  CE_CODED_RESULT_DOC,
  PRSNL  PRSNL_DCP_FORMS_ACT,
  CLINICAL_EVENT  CLINICAL_EVENT_DOC,
  CLINICAL_EVENT  CE_SECTIONS,
  DCP_FORMS_ACTIVITY_COMP
WHERE
  ( ENCOUNTER.ENCNTR_TYPE_CD=CV_ENCOUTER_TYPE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCOUNTER.MED_SERVICE_CD=CV_MEDICAL_SERVICE.CODE_VALUE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CV_FACILITY.CODE_VALUE=ENCOUNTER.LOC_FACILITY_CD AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( DCP_FORMS_REF.DCP_FORMS_REF_ID=DCP_FORMS_ACTIVITY.DCP_FORMS_REF_ID
AND DCP_FORMS_REF.ACTIVE_IND = 1  )
  AND  ( CV_Form_Status.CODE_VALUE=DCP_FORMS_ACTIVITY.FORM_STATUS_CD  )
  AND  ( CLINICAL_EVENT_DOC.EVENT_CD=CV_EVENT_CD_DOC.CODE_VALUE AND CV_EVENT_CD_DOC.ACTIVE_IND=1  )
  AND  ( DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID=DCP_FORMS_ACTIVITY_PRSNL.DCP_FORMS_ACTIVITY_ID  )
  AND  ( CLINICAL_EVENT_DOC.EVENT_ID= CE_CODED_RESULT_DOC.EVENT_ID(+)  )
  AND  ( DCP_FORMS_ACTIVITY.DCP_FORMS_ACTIVITY_ID=DCP_FORMS_ACTIVITY_COMP.DCP_FORMS_ACTIVITY_ID
and DCP_FORMS_ACTIVITY.active_ind=1 AND DCP_FORMS_ACTIVITY_COMP.PARENT_ENTITY_NAME = 'CLINICAL_EVENT'  )
  AND  ( DCP_FORMS_ACTIVITY_COMP.PARENT_ENTITY_ID=CE_SECTIONS.PARENT_EVENT_ID
AND CE_SECTIONS.VIEW_LEVEL=0  )
  AND  ( CE_SECTIONS.EVENT_ID=CLINICAL_EVENT_DOC.PARENT_EVENT_ID
AND CLINICAL_EVENT_DOC.VIEW_LEVEL=1
AND CLINICAL_EVENT_DOC.VALID_UNTIL_DT_TM> pi_to_gmt(sysdate, pi_time_zone(1,@variable('BOUSER')))  )
  AND  ( DCP_FORMS_ACTIVITY.ENCNTR_ID=ENCOUNTER.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 and DCP_FORMS_ACTIVITY.PERSON_ID = ENCOUNTER.PERSON_ID  )
  AND  ( ENCOUNTER.SERVICE_CATEGORY_CD=CV_SERVICE_CAT.CODE_VALUE  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCOUNTER.PERSON_ID=PERSON.PERSON_ID  )
  AND  ( DCP_FORMS_ACTIVITY_PRSNL.PRSNL_ID=PRSNL_DCP_FORMS_ACT.PERSON_ID  )
  AND  ( PRSNL_DCP_FORMS_ACT.POSITION_CD=CV_FORMS_POSITION.CODE_VALUE  )
  AND  ( PERSON.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( CE_CODED_RESULT_DOC.VALID_UNTIL_DT_TM(+) = to_date('12/31/2100','MM/DD/YYYY') 
  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CE_SECTIONS.VALID_UNTIL_DT_TM > pi_to_gmt(sysdate, pi_time_zone(1,@Variable('BOUSER')))   )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CV_EVENT_CD_DOC.active_ind = 1  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   PERSON.NAME_LAST_KEY  NOT LIKE  'ZZ%'
   AND
   ENCOUNTER.DISCH_DT_TM  Is Null  
   AND
   ENCOUNTER.ENCNTR_TYPE_CD  IN  ( 309314  )
   AND
   CV_FACILITY.DISPLAY  IN  @dpvalue('A', DP2.DO10e)
   AND
   CV_FORMS_POSITION.DISPLAY  IN  ( 'Occupational Therapist','Occupational Therapist ASC','Occupational Therapist Research','Occupational Therapy Assistant','Physical Therapist','Physical Therapist ASC','Physical Therapist Research','Physical Therapy Assistant','Rehab Director','Rehab Director ASC','Rehab Director Research','Speech Language Pathologist','Speech Language Pathologist ASC'  )
   AND
   DCP_FORMS_ACTIVITY.FORM_STATUS_CD  IN  ( 25, 34, 35  )
   AND
   CV_EVENT_CD_DOC.DISPLAY  IN  ( 'OT Frequency','OT Frequency Projected','OT Frequency Rehab','PT Frequency','PT Frequency Projected','PT Frequency Rehab','SLP Frequency','SLP Frequency Projected','ST Treatment Frequency'  )
  AND  (CV_EVENT_CD_DOC.active_ind = 1)
  )

/* SCHED APPT Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  pi_from_gmt(APPT_SCH_APPT.BEG_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  APPT_APPT_TYPE.Display,
  PI_GET_CV_DISPLAY(APPT_SCH_EVENT.SCH_STATE_CD)
,
  APPT_RESOURCE_PRSNL.NAME_FULL_FORMATTED

FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  SCH_APPT  APPT_SCH_APPT,
  SCH_EVENT  APPT_SCH_EVENT,
  CODE_VALUE  APPT_APPT_TYPE,
  PRSNL  APPT_RESOURCE_PRSNL,
  ENCOUNTER,
  SCH_RESOURCE  APPT_SCH_RESOURCE,
  SCH_APPT  APPT_SCH_RES_APPT
WHERE
  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( (APPT_SCH_EVENT.SCH_EVENT_ID=APPT_SCH_APPT.SCH_EVENT_ID AND
 APPT_SCH_APPT.role_meaning = 'PATIENT' and
 APPT_SCH_APPT.state_meaning != 'RESCHEDULED' )
  )
  AND  ( APPT_SCH_RES_APPT.RESOURCE_CD=APPT_SCH_RESOURCE.RESOURCE_CD
  )
  AND  ( (APPT_SCH_EVENT.SCH_EVENT_ID=APPT_SCH_RES_APPT.SCH_EVENT_ID AND
APPT_SCH_RES_APPT.role_meaning != 'PATIENT' and
 APPT_SCH_RES_APPT.state_meaning not in ('RESCHEDULED', 'CANCELED', 'DELETED')   and
(APPT_SCH_RES_APPT.slot_state_meaning != 'REMOVED' or APPT_SCH_RES_APPT.slot_state_meaning is null))  )
  AND  ( APPT_APPT_TYPE.CODE_VALUE=APPT_SCH_EVENT.APPT_TYPE_CD  )
  AND  ( APPT_SCH_RESOURCE.PERSON_ID=APPT_RESOURCE_PRSNL.PERSON_ID  )
  AND  ( APPT_SCH_APPT.ENCNTR_ID=ENCOUNTER.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( V500.EDW_GET_LOCATION_GROUP_TEXT(APPT_SCH_APPT.appt_location_cd,1,'desc')  =  'Spokane Hospital'  )  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   ENCNTR_ALIAS.ALIAS  IN  @dpvalue('A', DP2.DO55)
  AND  (CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1)
   AND
   APPT_APPT_TYPE.Display  NOT IN  ( 'Respiratory Therapy'  )
  )

/* CLINICAL EVENT Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  pi_from_gmt(CLINICAL_EVENT.VERIFIED_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CE_PRSNL_VERF.NAME_FULL_FORMATTED,
  PI_GET_CV_DISPLAY(CE_PRSNL_VERF.POSITION_CD)
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  CLINICAL_EVENT,
  PRSNL  CE_PRSNL_VERF,
  ENCOUNTER,
  PERSON  CE_PERSON_VERF
WHERE
  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( ENCOUNTER.ENCNTR_ID=CLINICAL_EVENT.ENCNTR_ID AND ENCOUNTER.ACTIVE_IND = 1 AND ENCOUNTER.PERSON_ID = CLINICAL_EVENT.PERSON_ID  )
  AND  ( CLINICAL_EVENT.VERIFIED_PRSNL_ID=CE_PERSON_VERF.PERSON_ID  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( CE_PRSNL_VERF.PERSON_ID=CE_PERSON_VERF.PERSON_ID  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( CLINICAL_EVENT.VERIFIED_DT_TM = (SELECT MAX(CE.VERIFIED_DT_TM)
                                     FROM CLINICAL_EVENT CE
                                     WHERE CE.EVENT_CD +0 = CLINICAL_EVENT.EVENT_CD
                                     AND CE.ENCNTR_ID = CLINICAL_EVENT.ENCNTR_ID)  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  (
   ENCNTR_ALIAS.ALIAS  IN  @dpvalue('A', DP2.DO55)
  AND  (CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1)
   AND
   PI_GET_CV_DISPLAY(CE_PRSNL_VERF.POSITION_CD)  IN  ( 'Rehab Assistant/Technician','Rehab Clerk/Scheduler','Rehab Director','Rehab Director ASC','Rehab Director Research','Rehab Prov ASC','Rehab Student','Rehab Therapist','Rehab Therapist Research','Rehab Therapy Student','Occupational Therapist','Occupational Therapist ASC','Occupational Therapist Research','Occupational Therapy Assistant','Physical Therapist','Physical Therapist ASC','Physical Therapist Research','Physical Therapy Assistant','Speech Language Pathologist','Speech Language Pathologist ASC'  )
  )

/* FINAL CHARGE Script */

SELECT
  ENCNTR_ALIAS.ALIAS,
  pi_from_gmt(CHARGE.SERVICE_DT_TM,( @Prompt('Choose Time Zone','A','Relative Dates\TZ Prompt List',mono,free,persistent,{' '},) )),
  CV_CHARGE_ACT_TYPE.DISPLAY,
  CHARGE_MOD.FIELD7,
  CASE INSTR(UPPER(CV_CHARGE_TYPE_CD.DISPLAY),'CREDIT')
When 0 then CHARGE.ITEM_QUANTITY
else CHARGE.ITEM_QUANTITY * -1
end
FROM
  ENCNTR_ALIAS,
  CODE_VALUE  CV_ENCNTR_ALIAS_TYPE,
  CHARGE,
  CODE_VALUE  CV_CHARGE_ACT_TYPE,
  CHARGE_MOD,
  CODE_VALUE  CV_CHARGE_TYPE_CD,
  ENCOUNTER
WHERE
  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM > SYSDATE AND ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD=CV_ENCNTR_ALIAS_TYPE.CODE_VALUE  )
  AND  ( CHARGE.CHARGE_TYPE_CD=CV_CHARGE_TYPE_CD.CODE_VALUE  )
  AND  ( CHARGE.ACTIVITY_TYPE_CD=CV_CHARGE_ACT_TYPE.CODE_VALUE  )
  AND  ( CHARGE_MOD.CHARGE_ITEM_ID=CHARGE.CHARGE_ITEM_ID
AND CHARGE_MOD.FIELD1_ID= any(select cv.code_value from code_value cv
where cv.cdf_meaning like '%CDM%')
  )
  AND  ( CHARGE.ENCNTR_ID(+)=ENCOUNTER.ENCNTR_ID  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_VALUE=ENCNTR_ALIAS.ENCNTR_ALIAS_TYPE_CD  )
  AND  ( ENCNTR_ALIAS.ENCNTR_ID=ENCOUNTER.ENCNTR_ID
AND ENCNTR_ALIAS.ACTIVE_IND = 1
AND ENCNTR_ALIAS.END_EFFECTIVE_DT_TM>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@variable('BOUSER')))
AND ENCOUNTER.ACTIVE_IND = 1

  )
  AND  ( ENCOUNTER.ACTIVE_IND = 1  )
  AND  ( CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1  )
  AND  ( ENCOUNTER.LOC_FACILITY_CD = 648383  )
  AND  
  ENCNTR_ALIAS.ALIAS  IN  @dpvalue('A', DP2.DO55)
  AND  (CV_ENCNTR_ALIAS_TYPE.CODE_SET = 319 
and CV_ENCNTR_ALIAS_TYPE.CDF_MEANING = 'FIN NBR'
and ENCNTR_ALIAS.end_effective_dt_tm>PI_TO_GMT(sysdate, PI_TIME_ZONE(1,@Variable('BOUSER')))
and ENCNTR_ALIAS.active_ind=1)
